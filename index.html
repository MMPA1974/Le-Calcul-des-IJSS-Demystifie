<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur d'Indemnit√©s Journali√®res (IJSS)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony with vibrant accents -->
    <!-- Application Structure Plan: The application is designed as an interactive dashboard, moving beyond the linear structure of the report. The core is an "IJSS Simulator" (Section 1) allowing users to get immediate answers for specific cases, which is their primary need. This is supported by a "Comparative View" (Section 2) using cards and a dynamic chart to contrast different leave types, facilitating a deeper understanding of the system's logic. Finally, "Key Concepts & Resources" (Section 3) are organized in an accordion, providing detailed information on demand without cluttering the main interface. This task-oriented structure prioritizes usability and quick access to relevant calculations over simply replicating the report's text. -->
    <!-- Visualization & Content Choices: Report Info -> Goal -> Calculate -> Interactive Form/Simulator -> User selects leave type & inputs data, JS calculates and displays results -> Practical, answers user's main question -> Vanilla JS. 2. Comparison of Leave Types -> Goal: Compare -> Bar Chart -> Checkboxes filter the leave types shown on the chart -> Visual comparison is faster than reading a table -> Chart.js. 3. Detailed Rules (Rechute, Salaire R√©tabli, Cong√©s Pay√©s) -> Goal: Organize/Inform -> Accordion & Styled HTML flow -> Click to expand/collapse sections -> Keeps UI clean, avoids info overload -> Vanilla JS + Tailwind CSS. This structure provides a tool, not just a document. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            color: #1e293b; /* slate-900 for strong contrast in light mode */
        }
        body.dark {
            background-color: #0f172a; /* slate-900 */
            color: #e2e8f0; /* slate-200 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b; /* slate-800 */
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e2e8f0; /* slate-200 */
        }
        body.dark .section-title {
            color: #f8fafc; /* slate-50 */
            border-bottom-color: #334155; /* slate-700 */
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        body.dark .card {
            background-color: #1e293b; /* slate-800 */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.3), 0 2px 4px -2px rgb(0 0 0 / 0.3);
            border-color: #334155; /* slate-700 */
        }
        .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 500;
            font-size: 0.875rem;
        }
        /* Tag colors for light mode */
        .tag.bg-red-100 { background-color: #fee2e2; color: #b91c1c; } /* red-100, red-700 */
        .tag.bg-yellow-100 { background-color: #fffbeb; color: #b45309; } /* yellow-100, yellow-700 */
        .tag.bg-purple-100 { background-color: #f3e8ff; color: #6b21a8; } /* purple-100, purple-700 */

        /* Tag colors for dark mode */
        body.dark .tag.bg-red-100 { background-color: #7f1d1d; color: #fca5a5; } /* red-900, red-300 */
        body.dark .tag.bg-yellow-100 { background-color: #78350f; color: #fcd34d; } /* yellow-900, yellow-300 */
        body.dark .tag.bg-purple-100 { background-color: #581c87; color: #d8b4fe; } /* purple-900, purple-300 */

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            color: white;
            transition: background-color 0.3s;
            cursor: pointer;
        }
        .btn-primary {
            background-color: #2563eb; /* blue-600 */
        }
        .btn-primary:hover {
            background-color: #1d4ed8; /* blue-700 */
        }
        body.dark .btn-primary {
            background-color: #3b82f6; /* blue-500 */
        }
        body.dark .btn-primary:hover {
            background-color: #2563eb; /* blue-600 */
        }
        input, select {
            border: 1px solid #cbd5e1; /* slate-300 */
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            width: 100%;
            background-color: white;
            color: #475569;
        }
        body.dark input, body.dark select {
            border-color: #475569; /* slate-700 */
            background-color: #1e293b; /* slate-800 */
            color: #e2e8f0; /* slate-200 */
        }
        .accordion-content ul {
            list-style-position: inside;
            padding-left: 1rem;
        }
        .accordion-content ul li {
            margin-bottom: 0.5rem;
        }
        /* Specific card colors for simulator results */
        #carenceCard { background-color: #fffbeb; border-color: #fde68a; } /* amber-50, amber-300 */
        #carenceCard h4 { color: #b45309; } /* amber-800 */
        #sjrCard { background-color: #ecfeff; border-color: #a5f3fc; } /* cyan-50, cyan-300 */
        #sjrCard h4 { color: #0e7490; } /* cyan-800 */
        #ijssCard { background-color: #ecfdf5; border-color: #a7f3d0; } /* emerald-50, emerald-300 */
        #ijssCard h4 { color: #065f46; } /* emerald-800 */
        #resultContainer .card.bg-slate-50 { background-color: #f8fafc; border-color: #e2e8f0; } /* slate-50, slate-200 */
        #resultContainer .card.bg-slate-50 h4 { color: #1e293b; } /* slate-800 */

        /* Dark mode specific card colors for simulator results */
        body.dark #carenceCard { background-color: #451a03; border-color: #78350f; } /* amber-950, amber-900 */
        body.dark #carenceCard h4 { color: #fcd34d; } /* amber-300 */
        body.dark #sjrCard { background-color: #083344; border-color: #164e63; } /* cyan-950, cyan-900 */
        body.dark #sjrCard h4 { color: #67e8f9; } /* cyan-300 */
        body.dark #ijssCard { background-color: #064e3b; border-color: #047857; } /* emerald-950, emerald-900 */
        body.dark #ijssCard h4 { color: #6ee7b7; } /* emerald-300 */
        body.dark #resultContainer .card.bg-slate-50 { background-color: #1e293b; border-color: #334155; } /* slate-800, slate-700 */
        body.dark #resultContainer .card.bg-slate-50 h4 { color: #f8fafc; } /* slate-50 */

        /* New accordion item specific colors */
        .card.accordion-cp { background-color: #e0f7fa; border-color: #80deea; } /* cyan-50, cyan-300 */
        .card.accordion-rechute { background-color: #ffe0b2; border-color: #ffb74d; } /* orange-50, orange-300 */
        .card.accordion-sjr { background-color: #e8f5e9; border-color: #a5d6a7; } /* green-50, green-300 */
        .card.accordion-subrogation { background-color: #e3f2fd; border-color: #90caf9; } /* blue-50, blue-300 */
        .card.accordion-resources { background-color: #f3e5f5; border-color: #ce93d8; } /* purple-50, purple-300 */

        /* Dark mode for new accordion item specific colors */
        body.dark .card.accordion-cp { background-color: #004d40; border-color: #00897b; } /* teal-900, teal-600 */
        body.dark .card.accordion-rechute { background-color: #5e350b; border-color: #fb923c; } /* orange-900, orange-400 */
        body.dark .card.accordion-sjr { background-color: #1b5e20; border-color: #4caf50; } /* green-900, green-500 */
        body.dark .card.accordion-subrogation { background-color: #1a237e; border-color: #3f51b5; } /* indigo-900, indigo-500 */
        body.dark .card.accordion-resources { background-color: #4a148c; border-color: #ab47bc; } /* purple-900, purple-500 */

        .card.accordion-cp h4, .card.accordion-cp strong { color: #006064; } /* cyan-900 */
        .card.accordion-rechute h4, .card.accordion-rechute strong { color: #e65100; } /* orange-900 */
        .card.accordion-sjr h4, .card.accordion-sjr strong { color: #2e7d32; } /* green-900 */
        .card.accordion-subrogation h4, .card.accordion-subrogation strong { color: #1976d2; } /* blue-700 */
        .card.accordion-resources h4, .card.accordion-resources strong { color: #6a1b9a; } /* purple-900 */

        body.dark .card.accordion-cp h4, body.dark .card.accordion-cp strong { color: #80cbc4; } /* teal-200 */
        body.dark .card.accordion-rechute h4, body.dark .card.accordion-rechute strong { color: #ffcc80; } /* orange-200 */
        body.dark .card.accordion-sjr h4, body.dark .card.accordion-sjr strong { color: #a5d6a7; } /* green-200 */
        body.dark .card.accordion-subrogation h4, body.dark .card.accordion-subrogation strong { color: #9fa8da; } /* indigo-200 */
        body.dark .card.accordion-resources h4, body.dark .card.accordion-resources strong { color: #e1bee7; } /* purple-200 */

        /* General text for cards and accordion content */
        .card p, .card li {
            color: #475569; /* slate-700 for general text in light mode */
        }
        body.dark .card p, body.dark .card li {
            color: #e2e8f0; /* slate-200 */
        }
        /* Text for accordion toggles */
        .accordion-toggle span {
            color: #1e293b; /* slate-800 for accordion headers in light mode */
        }
        body.dark .accordion-toggle span {
            color: #e2e8f0; /* slate-200 */
        }
        /* Specific text for header and simulator impact section */
        header p { /* description under main title */
            color: #475569; /* slate-700 */
        }
        body.dark header p {
            color: #94a3b8; /* slate-400 */
        }
        #paieImpact { /* text in the impact card */
            color: #475569; /* slate-700 */
        }
        body.dark #paieImpact {
            color: #e2e8f0; /* slate-200 */
        }
    </style>
</head>
<body class="text-slate-700">

    <header class="bg-white shadow-md dark:bg-slate-800">
        <div class="container mx-auto px-4 py-6 flex justify-between items-center">
            <h1 class="text-3xl font-bold text-slate-900 dark:text-slate-50">‚ú® D√©mystifier le Calcul des IJSS</h1>
            <button id="themeToggle" class="p-2 rounded-full bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <span id="themeIcon" class="text-xl">‚òÄÔ∏è</span>
            </button>
        </div>
        <p class="text-slate-600 dark:text-slate-400 mt-1 px-4 mx-auto container">Un outil interactif pour les gestionnaires de paie. R√®gles √† jour au 1er juillet 2025.</p>
    </header>

    <main class="container mx-auto px-4 py-8 md:py-12">

        <!-- Section 1: Simulateur Interactif -->
        <section id="simulator" class="mb-16">
            <h2 class="section-title">üìä 1. Simulateur de Calcul d'IJSS</h2>
            <p class="mb-6 text-slate-600 dark:text-slate-400">
                Cette section vous permet de simuler le calcul des indemnit√©s pour un cas pr√©cis. S√©lectionnez le type d'arr√™t et remplissez les champs pour obtenir une estimation d√©taill√©e du calcul des IJSS, des jours de carence et de l'impact en paie. C'est l'outil principal pour appliquer directement les r√®gles du guide.
            </p>
            <div class="card">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div>
                        <label for="arretType" class="font-semibold block mb-2">üìù Type d'arr√™t</label>
                        <select id="arretType">
                            <option value="maladie">Maladie non professionnelle</option>
                            <option value="at">Accident du Travail / Trajet</option>
                            <option value="mp">Maladie Professionnelle</option>
                            <option value="maternite">Cong√© Maternit√© / Adoption</option>
                            <option value="paternite">Cong√© Paternit√©</option>
                        </select>
                    </div>
                    <div>
                        <label for="salaireRef" class="font-semibold block mb-2">üí∞ Salaire brut mensuel (‚Ç¨)</label>
                        <input type="number" id="salaireRef" placeholder="Ex: 2500" value="2500">
                    </div>
                    <div id="ancienneteContainer">
                        <label for="anciennete" class="font-semibold block mb-2">‚è≥ Anciennet√© (ann√©es)</label>
                        <input type="number" id="anciennete" placeholder="Ex: 3" value="3">
                    </div>
                    <div>
                        <label for="dureeArret" class="font-semibold block mb-2">üóìÔ∏è Dur√©e de l'arr√™t (jours calendaires)</label>
                        <input type="number"id="dureeArret" placeholder="Ex: 14" value="14">
                    </div>
                    <div class="lg:col-span-3 flex justify-center">
                           <button id="calculateBtn" class="btn btn-primary mt-4">üöÄ Lancer la simulation</button>
                    </div>
                </div>
                
                <div id="resultContainer" class="mt-8 pt-6 border-t border-slate-200 dark:border-slate-700 hidden">
                    <h3 class="text-xl font-semibold text-slate-800 dark:text-slate-50 mb-4">R√©sultats de la Simulation</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div id="carenceCard" class="bg-amber-100 border border-amber-300 p-4 rounded-lg">
                            <h4 class="font-bold text-amber-800">üóìÔ∏è Carence & Indemnisation</h4>
                            <p id="carenceResult" class="mt-2"></p>
                        </div>
                        <div id="sjrCard" class="bg-cyan-100 border border-cyan-300 p-4 rounded-lg">
                            <h4 class="font-bold text-cyan-800">üìä Calcul du SJR</h4>
                            <p id="sjrResult" class="mt-2"></p>
                        </div>
                        <div id="ijssCard" class="bg-emerald-100 border border-emerald-300 p-4 rounded-lg">
                            <h4 class="font-bold text-emerald-800">üíµ Montant des IJSS</h4>
                            <p id="ijssResult" class="mt-2"></p>
                        </div>
                    </div>
                    <div class="mt-6 card bg-slate-50 border border-slate-200">
                        <h4 class="font-bold text-slate-800 dark:text-slate-50">üßæ Impact et Logique Appliqu√©e</h4>
                        <p id="paieImpact" class="mt-2 text-slate-600 dark:text-slate-400"></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Vue Comparative -->
        <section id="comparison" class="mb-16">
            <h2 class="section-title">‚öñÔ∏è 2. Vue Comparative des Arr√™ts de Travail</h2>
            <p class="mb-6 text-slate-600 dark:text-slate-400">
                Pour mieux comprendre les diff√©rences fondamentales entre les types d'arr√™ts, cette section offre une comparaison visuelle. Les fiches ci-dessous r√©sument les points cl√©s de chaque situation. Le graphique interactif vous permet de comparer visuellement les taux d'indemnisation et les d√©lais de carence.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Cards -->
                <div class="card">
                    <h3 class="font-bold text-lg mb-2"><span class="tag bg-red-100 text-red-700">Maladie ü§í</span></h3>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Carence S√©curit√© Sociale (SS):</strong> 3 jours</p>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Carence Indemnisation employeur:</strong> 7 jours (selon anciennet√© et/ou CC - <a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006900984/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Art. L. 1226-1 Code du travail</a>)</p>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Taux IJSS:</strong> 50% du SJR (<a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006750316/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Art. L. 323-4 Code de la S√©curit√© Sociale</a>)</p>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Base SJR:</strong> 3 derniers mois (plafonn√©s √† 1,4 x SMIC)</p>
                </div>
                <div class="card">
                    <h3 class="font-bold text-lg mb-2"><span class="tag bg-yellow-100 text-yellow-700">AT / MP üë∑</span></h3>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Carence SS:</strong> 0 jour</p>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Jour de l'accident √† la charge de l'employeur</strong> (Jurisprudence constante, ex: <a href="https://www.legifrance.gouv.fr/juri/id/JURITEXT000007038161/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Cass. Soc. 28 oct. 1999, n¬∞97-43.180</a>)</p>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Taux IJSS:</strong> 60% puis 80% (<a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006750316/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Art. L. 433-1 Code de la S√©curit√© Sociale</a>)</p>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Base SJR:</strong> Mois pr√©c√©dent</p>
                </div>
                <div class="card">
                    <h3 class="font-bold text-lg mb-2"><span class="tag bg-purple-100 text-purple-700">Maternit√© ü§∞</span></h3>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Carence SS:</strong> 0 jour</p>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Carence Employeur:</strong> N/A (selon CC)</p>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Taux IJSS:</strong> 100% du gain journalier (<a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006750316/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Art. L. 331-3 Code de la S√©curit√© Sociale</a>)</p>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Base SJR:</strong> 3 derniers mois (plafonn√©s au PMSS)</p>
                </div>
                <div class="card">
                    <h3 class="font-bold text-lg mb-2"><span class="tag bg-purple-100 text-purple-700">Paternit√© üë®‚Äçüçº</span></h3>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Carence SS:</strong> 0 jour</p>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Carence Employeur:</strong> N/A (selon CC)</p>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Taux IJSS:</strong> 100% du gain journalier (<a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006750316/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Art. L. 331-3 Code de la S√©curit√© Sociale</a>)</p>
                    <p class="text-slate-700 dark:text-slate-300"><strong>Base SJR:</strong> 3 derniers mois (plafonn√©s au PMSS)</p>
                </div>
            </div>
            <div class="card">
                <h3 class="text-xl font-semibold text-slate-800 dark:text-slate-50 mb-4 text-center">Comparaison des Caract√©ristiques Cl√©s</h3>
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Section 3: Concepts Cl√©s & Ressources -->
        <section id="concepts">
            <h2 class="section-title">üìö 3. Concepts Cl√©s, Cas Particuliers & Ressources</h2>
            <p class="mb-6 text-slate-600 dark:text-slate-400">
                Explorez ici les notions plus complexes et les cas sp√©cifiques comme la rechute ou le calcul du salaire r√©tabli. Chaque section est un r√©sum√© interactif des parties du guide, vous permettant d'approfondir un sujet √† la demande. Vous y trouverez √©galement les liens vers les ressources officielles.
            </p>
            <div class="space-y-4">
                <!-- Accordion Item : Cong√©s Pay√©s -->
                <div class="card accordion-cp">
                    <button class="w-full text-left font-semibold text-lg flex justify-between items-center accordion-toggle">
                        <span>üóìÔ∏è Acquisition des Cong√©s Pay√©s pendant un Arr√™t Maladie</span>
                        <span class="transform transition-transform text-slate-500 dark:text-slate-400">‚ñº</span>
                    </button>
                    <div class="accordion-content hidden mt-4 pt-4 border-t border-slate-200 dark:border-slate-700">
                        <p class="mb-4">Suite √† la **Loi n¬∞ 2024-364 du 22 avril 2024** (<a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006900984/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Art. L. 3141-5 Code du travail</a>), les arr√™ts maladie non professionnels ouvrent d√©sormais droit √† l'acquisition de cong√©s pay√©s, alignant le droit fran√ßais sur le droit europ√©en.</p>
                        <h4 class="font-bold mt-4 mb-2">R√®gles d'Acquisition (depuis le 24/04/2024)</h4>
                        <ul>
                            <li><strong>Taux :</strong> Le salari√© acquiert <strong>2 jours ouvrables</strong> de cong√©s par mois d'arr√™t.</li>
                            <li><strong>Plafond :</strong> L'acquisition est limit√©e √† <strong>24 jours ouvrables (4 semaines)</strong> par an pour cause de maladie non professionnelle.</li>
                            <li><strong>R√©troactivit√© :</strong> La mesure est r√©troactive pour les arr√™ts d√©butant √† partir du 1er d√©cembre 2009.</li>
                        </ul>
                        <h4 class="font-bold mt-4 mb-2">D√©lai pour poser les cong√©s</h4>
                        <ul>
                            <li><strong>Obligation d'information :</strong> L'employeur doit informer le salari√© de ses droits √† cong√©s acquis dans le mois suivant sa reprise.</li>
                            <li><strong>D√©lai de report :</strong> Le salari√© dispose de <strong>15 mois</strong> apr√®s avoir √©t√© inform√© pour prendre ces cong√©s.</li>
                        </ul>
                        <p class="mt-4 text-sm text-slate-500 dark:text-slate-400">Pour plus de d√©tails, consultez les sources officielles dans l'onglet "Ressources".</p>
                    </div>
                </div>

                <!-- Accordion Item 1 -->
                <div class="card accordion-rechute">
                    <button class="w-full text-left font-semibold text-lg flex justify-between items-center accordion-toggle">
                        <span>üîÑ La Rechute d'Accident du Travail / Maladie Professionnelle</span>
                        <span class="transform transition-transform text-slate-500 dark:text-slate-400">‚ñº</span>
                    </button>
                    <div class="accordion-content hidden mt-4 pt-4 border-t border-slate-200 dark:border-slate-700">
                        <p class="mb-4">Une rechute survient lorsqu'une nouvelle incapacit√© de travail est li√©e √† un AT/MP d√©j√† reconnu. Son traitement est similaire √† l'arr√™t initial (pas de carence CPAM, taux AT/MP), mais suit une proc√©dure sp√©cifique de reconnaissance.</p>
                        <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 items-center justify-center">
                            <div class="text-center p-4 bg-slate-100 rounded-lg dark:bg-slate-700 dark:text-slate-300"><strong>1. D√©claration de rechute</strong><br><small>L'employeur transmet la d√©claration de rechute √† la CPAM.</small></div>
                            <div class="text-2xl text-slate-400 dark:text-slate-500">‚Üí</div>
                            <div class="text-center p-4 bg-slate-100 rounded-lg dark:bg-slate-700 dark:text-slate-300"><strong>2. D√©cision CPAM</strong><br><small>La Caisse √©tudie le lien avec l'AT/MP initial.</small></div>
                            <div class="text-2xl text-slate-400 dark:text-slate-500">‚Üí</div>
                            <div class="text-center p-4 bg-green-100 rounded-lg dark:bg-green-900 dark:text-green-200"><strong>3. Requalification</strong><br><small>Si reconnue, l'arr√™t est trait√© comme un AT/MP (pas de carence, taux de 60%/80%).</small></div>
                        </div>
                    </div>
                </div>
                <!-- Accordion Item 2 -->
                <div class="card accordion-sjr">
                    <button class="w-full text-left font-semibold text-lg flex justify-between items-center accordion-toggle">
                        <span>üìà Le Salaire R√©tabli</span>
                        <span class="transform transition-transform text-slate-500 dark:text-slate-400">‚ñº</span>
                    </button>
                    <div class="accordion-content hidden mt-4 pt-4 border-t border-slate-200 dark:border-slate-700">
                        <p>Si le salari√© a eu des absences non ou partiellement r√©mun√©r√©es (maladie, ch√¥mage partiel, etc.) pendant la p√©riode de r√©f√©rence, son salaire doit √™tre "r√©tabli" pour le calcul des IJSS. L'employeur calcule le salaire que le salari√© *aurait per√ßu* s'il avait travaill√© normalement. Cette information est transmise via la DSN et utilis√©e par la CPAM pour un calcul juste des indemnit√©s.</p>
                        <p class="mt-2"><strong>Exemples d'absences n√©cessitant un salaire r√©tabli :</strong> embauche en cours de mois, arr√™t maladie, cong√© maternit√©, AT, ch√¥mage partiel, cong√© sans solde.</p>
                        <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">R√©f√©rence: <a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006750316/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Article R.323-8 du Code de la S√©curit√© Sociale</a>.</p>
                    </div>
                </div>
                <!-- Accordion Item 3 -->
                <div class="card accordion-subrogation">
                    <button class="w-full text-left font-semibold text-lg flex justify-between items-center accordion-toggle">
                        <span>ü§ù Subrogation et Pr√©voyance</span>
                        <span class="transform transition-transform text-slate-500 dark:text-slate-400">‚ñº</span>
                    </button>
                    <div class="accordion-content hidden mt-4 pt-4 border-t border-slate-200 dark:border-slate-700">
                        <h4 class="font-bold mb-2">La Subrogation</h4>
                        <p>L'employeur peut demander √† percevoir les IJSS √† la place du salari√©. C'est une condition pour le maintien de salaire : le salaire maintenu doit √™tre au moins √©gal aux IJSS. Cela permet d'assurer une continuit√© de revenu pour le salari√© sur son bulletin de paie.</p>
                        <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">R√©f√©rence: <a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006750316/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Article L. 323-1 du Code de la S√©curit√© Sociale</a> (principe g√©n√©ral des IJSS et de la subrogation).</p>
                        <h4 class="font-bold mt-4 mb-2">Le Compl√©ment Pr√©voyance</h4>
                        <p>Lorsqu'un maintien de salaire partiel est pr√©vu (ex: 80%) et que la subrogation cesse, un contrat de pr√©voyance collective peut prendre le relais. L'assureur verse un compl√©ment pour atteindre le pourcentage de maintien garanti par le contrat. Ce compl√©ment est √† identifier en paie et est g√©n√©ralement soumis √† la CSG/CRDS.</p>
                    </div>
                </div>
                <!-- Accordion Item 4 -->
                <div class="card accordion-resources">
                    <button class="w-full text-left font-semibold text-lg flex justify-between items-center accordion-toggle">
                        <span>üåê Ressources Officielles</span>
                        <span class="transform transition-transform text-slate-500 dark:text-slate-400">‚ñº</span>
                    </button>
                    <div class="accordion-content hidden mt-4 pt-4 border-t border-slate-200 dark:border-slate-700">
                        <ul class="list-disc list-inside space-y-2">
                            <li><a href="https://www.ameli.fr" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400"><strong>Ameli.fr :</strong></a> La r√©f√©rence pour les r√®gles de la S√©curit√© Sociale.</li>
                            <li><a href="https://www.service-public.fr" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400"><strong>Service-Public.fr :</strong></a> Informations vulgaris√©es sur le droit du travail.</li>
                            <li><a href="https://www.legifrance.gouv.fr" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400"><strong>L√©gifrance :</strong></a> Acc√®s direct au Code du Travail, Code de la S√©curit√© Sociale et aux jurisprudences.</li>
                            <li><a href="https://boss.gouv.fr" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400"><strong>Boss.gouv.fr :</strong></a> Le Bulletin Officiel des Urssaf, centralisant la doctrine de la S√©curit√© Sociale.</li>
                            <li><a href="https://www.net-entreprises.fr" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400"><strong>Net-Entreprises.fr :</strong></a> Le portail pour la DSN et la subrogation.</li>
                        </ul>
                        <p class="text-sm mt-4 text-slate-500 dark:text-slate-400">Il est recommand√© de toujours v√©rifier les conventions collectives qui peuvent pr√©voir des dispositions plus favorables.</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-slate-800 text-white mt-12 dark:bg-slate-950">
        <div class="container mx-auto px-4 py-6 text-center text-slate-300 dark:text-slate-400">
            <p>Outil interactif cr√©√© √† partir du "Guide Complet sur le Calcul des IJSS".</p>
            <p class="text-sm mt-1">Les calculs sont des estimations bas√©es sur les r√®gles g√©n√©rales et la **r√©glementation en vigueur au 1er juillet 2025**.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- CONSTANTES 2025 (R√©glementation au 1er juillet 2025) ---
            // Les valeurs ci-dessous sont confirm√©es comme √©tant en vigueur au 1er juillet 2025,
            // sans modification par rapport aux revalorisations du 1er janvier ou 1er avril 2025.
            const SMIC_MENSUEL_BRUT_2025 = 1801.80; // Source: Insee, La Paie Facile (stable depuis Nov 2024)
            const PMSS_MENSUEL_2025 = 3925; // Source: Service-Public.fr, BOSS (fix√© au 1er Janvier 2025)
            const PLAFOND_IJSS_MALADIE_2025_BRUT = 41.47; // Source: LegiSocial, AXA (applicable depuis le 1er Avril 2025)
            const PLAFOND_IJSS_PATERNITE_2025_BRUT = 101.94; // Source: Culture RH (fix√© au 1er Janvier 2025)
            const PLAFOND_IJSS_ATMP_60_2025_BRUT = 235.69; // Source: Culture RH (fix√© au 1er Janvier 2025)
            const PLAFOND_IJSS_ATMP_80_2025_BRUT = 314.25; // Source: Culture RH (fix√© au 1er Janvier 2025)

            const arretTypeSelect = document.getElementById('arretType');
            const salaireRefInput = document.getElementById('salaireRef');
            const ancienneteInput = document.getElementById('anciennete');
            const dureeArretInput = document.getElementById('dureeArret');
            const calculateBtn = document.getElementById('calculateBtn');
            const resultContainer = document.getElementById('resultContainer');
            
            const carenceResultEl = document.getElementById('carenceResult');
            const sjrResultEl = document.getElementById('sjrResult');
            const ijssResultEl = document.getElementById('ijssResult');
            const paieImpactEl = document.getElementById('paieImpact');
            const ancienneteContainer = document.getElementById('ancienneteContainer');
            
            // Theme Toggle Logic
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            const htmlElement = document.documentElement;

            // Check for saved theme preference or system preference
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme === 'dark' || (!currentTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                htmlElement.classList.add('dark');
                document.body.classList.add('dark');
                themeIcon.textContent = 'üåô';
            } else {
                themeIcon.textContent = '‚òÄÔ∏è';
            }

            themeToggle.addEventListener('click', () => {
                if (htmlElement.classList.contains('dark')) {
                    htmlElement.classList.remove('dark');
                    document.body.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                    themeIcon.textContent = '‚òÄÔ∏è';
                } else {
                    htmlElement.classList.add('dark');
                    document.body.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                    themeIcon.textContent = 'üåô';
                }
                updateChartColors(); // Update chart colors on theme change
            });

            arretTypeSelect.addEventListener('change', () => {
                if (arretTypeSelect.value === 'maladie') {
                    ancienneteContainer.style.display = 'block';
                } else {
                    ancienneteContainer.style.display = 'none';
                }
            });
            
            calculateBtn.addEventListener('click', () => {
                const type = arretTypeSelect.value;
                const salaire = parseFloat(salaireRefInput.value) || 0;
                const anciennete = parseInt(ancienneteInput.value) || 0;
                const duree = parseInt(dureeArretInput.value) || 0;

                let carenceSS = 0;
                let carenceEmployeur = 0;
                let sjr = 0;
                let ijssBruteJournaliere = 0; // For maternit√©/paternit√©
                let tauxIJSS = 0;
                let baseCalculSJR = '';
                let paieImpactText = '';
                let totalIJSSBrutes = 0;
                let totalIJSSNettes = 0;
                let joursIndemnisesCPAM_Display = 0;
                
                // Specific variables for AT/MP, initialized to avoid undefined errors
                let gainJournalierNet = 0;
                let ijssDaily60 = 0;
                let ijssDaily80 = 0;

                switch (type) {
                    case 'maladie':
                        carenceSS = 3;
                        // La carence employeur de 7 jours est une disposition l√©gale li√©e √† la loi de mensualisation (apr√®s 1 an d'anciennet√©)
                        // Article L. 1226-1 du Code du travail
                        if (anciennete >= 1) carenceEmployeur = 7; 
                        
                        // Salaire journalier de base plafonn√© √† 1.4 SMIC mensuel
                        // Article L. 323-4 Code de la S√©curit√© Sociale
                        const salairePlafonneMaladieMensuel = Math.min(salaire, 1.4 * SMIC_MENSUEL_BRUT_2025);
                        sjr = (salairePlafonneMaladieMensuel * 3) / 91.25; // SJR sur 3 mois
                        
                        tauxIJSS = 0.50;
                        ijssBruteJournaliere = Math.min(sjr * tauxIJSS, PLAFOND_IJSS_MALADIE_2025_BRUT);

                        baseCalculSJR = `((min(${salaire.toFixed(2)}‚Ç¨, 1.4 x SMIC) x 3) / 91,25)`;
                        joursIndemnisesCPAM_Display = Math.max(0, duree - carenceSS);
                        totalIJSSBrutes = joursIndemnisesCPAM_Display * ijssBruteJournaliere;
                        
                        paieImpactText = `Pour une maladie non professionnelle, voici la logique appliqu√©e :<br>
                        <ul>
                            <li><strong>D√©duction employeur :</strong> ${duree} jours d'absence sont d√©duits.</li>
                            <li><strong>D√©lai de carence CPAM :</strong> 3 jours. L'indemnisation d√©bute √† partir du 4√®me jour (<a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006750316/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Art. L. 323-1 Code de la S√©curit√© Sociale</a>).</li>
                            <li><strong>Base de calcul :</strong> Salaire de r√©f√©rence plafonn√© √† 1,4 fois le SMIC (${(1.4 * SMIC_MENSUEL_BRUT_2025).toFixed(2)}‚Ç¨/mois), applicable depuis le 1er avril 2025 (<a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006750316/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Art. L. 323-4 Code de la S√©curit√© Sociale</a>).</li>
                            <li><strong>Plafond IJSS journali√®re :</strong> L'IJSS brute journali√®re est plafonn√©e √† ${PLAFOND_IJSS_MALADIE_2025_BRUT.toFixed(2)}‚Ç¨.</li>
                            <li><strong>Maintien de salaire employeur :</strong> ${anciennete >= 1 ? `Avec ${anciennete} an(s) d'anciennet√©, un maintien de salaire l√©gal (90% puis 2/3) s'applique apr√®s 7 jours de carence (<a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006900984/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Art. L. 1226-1 Code du travail</a>). L'employeur peut opter pour la subrogation.` : `Moins d'un an d'anciennet√©, pas de maintien l√©gal. Le salari√© per√ßoit les IJSS directement (sauf si convention collective plus favorable).`}</li>
                        </ul>`;
                        break;
                    
                    case 'at':
                    case 'mp':
                        carenceSS = 0; 
                        carenceEmployeur = 0; // Jour de l'accident √† la charge de l'employeur
                        
                        // Salaire journalier de base (SJB) - Art. R. 433-5 Code de la S√©curit√© Sociale
                        sjr = salaire / 30.42;
                        baseCalculSJR = `(${salaire.toFixed(2)}‚Ç¨ / 30,42)`;

                        // Gain Journalier Net (SJB - 21%)
                        gainJournalierNet = sjr * (1 - 0.21);

                        // Calcul IJSS pour les 28 premiers jours (60%) et au-del√† (80%)
                        // Articles L. 433-1 et R. 433-5 Code de la S√©curit√© Sociale
                        // Les IJSS sont plafonn√©es au gain journalier net ET aux plafonds sp√©cifiques AT/MP
                        ijssDaily60 = Math.min(sjr * 0.60, gainJournalierNet, PLAFOND_IJSS_ATMP_60_2025_BRUT);
                        ijssDaily80 = Math.min(sjr * 0.80, gainJournalierNet, PLAFOND_IJSS_ATMP_80_2025_BRUT);

                        // Jours indemnis√©s par la CPAM (d√®s le lendemain de l'accident)
                        const joursIndemnisesCPAM_ATMP = Math.max(0, duree - 1); 
                        joursIndemnisesCPAM_Display = joursIndemnisesCPAM_ATMP; 

                        const jours60Percent = Math.min(joursIndemnisesCPAM_ATMP, 27); // 27 jours apr√®s le jour de l'accident
                        const jours80Percent = Math.max(0, joursIndemnisesCPAM_ATMP - 27);

                        totalIJSSBrutes = (jours60Percent * ijssDaily60) + (jours80Percent * ijssDaily80);
                        
                        let typeText = type === 'at' ? "un accident du travail ou de trajet" : "une maladie professionnelle";
                        paieImpactText = `Pour ${typeText}, voici la logique appliqu√©e :<br>
                        <ul>
                            <li><strong>Jour de l'accident/constatation :</strong> Pay√© par l'employeur.</li>
                            <li><strong>D√©lai de carence CPAM :</strong> Aucun ! Les IJSS sont vers√©es d√®s le lendemain (<a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006750316/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Art. L. 433-1 Code de la S√©curit√© Sociale</a>).</li>
                            <li><strong>Taux d'indemnisation :</strong>
                                <ul>
                                    <li>60% pour les 28 premiers jours d'arr√™t (IJSS max ${PLAFOND_IJSS_ATMP_60_2025_BRUT.toFixed(2)}‚Ç¨/jour).</li>
                                    <li>80% √† partir du 29√®me jour (IJSS max ${PLAFOND_IJSS_ATMP_80_2025_BRUT.toFixed(2)}‚Ç¨/jour - <a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006750316/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Art. R. 433-5 Code de la S√©curit√© Sociale</a>).</li>
                                </ul>
                            </li>
                            <li><strong>Maintien de salaire :</strong> Souvent total via la convention collective, avec subrogation.</li>
                        </ul>`;
                        break;
                    
                    case 'maternite':
                    case 'paternite':
                        carenceSS = 0;
                        carenceEmployeur = 0; // Pas de carence employeur l√©gale sp√©cifique, d√©pend de la CC
                        
                        // Salaire plafonn√© au PMSS mensuel - Articles L. 331-3 et R. 331-5 Code de la S√©curit√© Sociale
                        const salairePlafPMSS = Math.min(salaire, PMSS_MENSUEL_2025); 
                        const salaireNetReconstitu√© = (salairePlafPMSS * 3) * (1 - 0.21);
                        sjr = salaireNetReconstitu√© / 91.25; // SJR apr√®s abattement de 21%
                        baseCalculSJR = `((min(${salaire.toFixed(2)}‚Ç¨, PMSS ${PMSS_MENSUEL_2025}‚Ç¨) x 3) x (1-21%)) / 91,25`;
                        
                        ijssBruteJournaliere = Math.min(sjr, PLAFOND_IJSS_PATERNITE_2025_BRUT); 
                        tauxIJSS = 1; // 100% du SJR net reconstitu√©

                        joursIndemnisesCPAM_Display = duree; 
                        totalIJSSBrutes = joursIndemnisesCPAM_Display * ijssBruteJournaliere;

                        let congeText = type === 'maternite' ? "un cong√© maternit√©" : "un cong√© paternit√©";
                        paieImpactText = `Pour ${congeText}, voici la logique appliqu√©e :<br>
                        <ul>
                            <li><strong>D√©lai de carence :</strong> Aucun ! L'indemnisation d√©bute d√®s le 1er jour (<a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006750316/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Art. L. 331-3 Code de la S√©curit√© Sociale</a>).</li>
                            <li><strong>Calcul de l'indemnisation :</strong> √âgale au gain journalier de base.</li>
                            <li><strong>Base de calcul :</strong> Salaires des 3 mois pr√©c√©dant le cong√©, plafonn√©s au PMSS (${PMSS_MENSUEL_2025}‚Ç¨/mois - <a href="https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000006750316/" target="_blank" class="text-blue-600 hover:underline dark:text-blue-400">Art. R. 331-5 Code de la S√©curit√© Sociale</a>).</li>
                            <li><strong>Plafond IJSS journali√®re :</strong> L'IJSS brute journali√®re est plafonn√©e √† ${PLAFOND_IJSS_PATERNITE_2025_BRUT.toFixed(2)}‚Ç¨.</li>
                            <li><strong>Maintien de salaire :</strong> Le maintien √† 100% avec subrogation est tr√®s fr√©quent via les conventions collectives.</li>
                        </ul>`;
                        break;
                }
                
                totalIJSSNettes = totalIJSSBrutes * (1 - 0.067); // CSG/CRDS √† 6.7%
                
                carenceResultEl.innerHTML = `
                    <strong>Carence CPAM:</strong> ${carenceSS} jours<br>
                    <strong>Carence Employeur (l√©gale):</strong> ${carenceEmployeur} jours<br>
                    <strong>Jours indemnis√©s par la CPAM:</strong> ${joursIndemnisesCPAM_Display} jours
                `;
                
                sjrResultEl.innerHTML = `
                    <strong>Base de calcul:</strong> ${baseCalculSJR}<br>
                    <strong>SJR brut:</strong> ${sjr.toFixed(2)} ‚Ç¨<br>
                    ${(type === 'at' || type === 'mp') ? `<strong>Gain Journalier Net:</strong> ${gainJournalierNet.toFixed(2)} ‚Ç¨` : `<strong>Taux appliqu√©:</strong> ${(tauxIJSS * 100).toFixed(0)}%`}
                `;

                ijssResultEl.innerHTML = `
                    ${(type === 'at' || type === 'mp') ? 
                        `<strong>IJSS journali√®re (J2-J28 de l'arr√™t):</strong> ${ijssDaily60.toFixed(2)} ‚Ç¨<br>
                        <strong>IJSS journali√®re (D√®s J29 de l'arr√™t):</strong> ${ijssDaily80.toFixed(2)} ‚Ç¨<br>` : 
                        `<strong>IJSS brute / jour:</strong> ${ijssBruteJournaliere.toFixed(2)} ‚Ç¨<br>`
                    }
                    <strong>Total IJSS brutes:</strong> ${totalIJSSBrutes.toFixed(2)} ‚Ç¨<br>
                    <strong>Total IJSS nettes (estim√©):</strong> <span class="font-bold">${totalIJSSNettes.toFixed(2)} ‚Ç¨</span>
                `;

                paieImpactEl.innerHTML = paieImpactText; // MODIFICATION ICI

                resultContainer.classList.remove('hidden');
            });

            let comparisonChart; 

            function initializeChart() {
                const chartColors = getChartColors();
                const comparisonChartCtx = document.getElementById('comparisonChart').getContext('2d');
                if (comparisonChart) {
                    comparisonChart.destroy(); 
                }
                comparisonChart = new Chart(comparisonChartCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Carence SS (jours)', 'Taux IJSS Initial (%)'],
                        datasets: [
                            {
                                label: 'Maladie',
                                data: [3, 50],
                                backgroundColor: chartColors.maladie.backgroundColor,
                                borderColor: chartColors.maladie.borderColor,
                                borderWidth: 1
                            },
                            {
                                label: 'AT / MP',
                                data: [0, 60], // Initial 60%, puis 80%
                                backgroundColor: chartColors.atmp.backgroundColor,
                                borderColor: chartColors.atmp.borderColor,
                                borderWidth: 1
                            },
                            {
                                label: 'Maternit√© / Paternit√©',
                                data: [0, 100],
                                backgroundColor: chartColors.maternityPaternity.backgroundColor,
                                borderColor: chartColors.maternityPaternity.borderColor,
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Carence et Taux d\'Indemnisation par Type d\'Arr√™t',
                                color: getComputedStyle(document.body).color 
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.x !== null) {
                                            label += context.parsed.x;
                                            if (context.label.includes('Taux')) {
                                                label += '%';
                                            } else {
                                                label += ' jours';
                                            }
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                ticks: {
                                    color: getComputedStyle(document.body).color 
                                },
                                grid: {
                                    color: htmlElement.classList.contains('dark') ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                                }
                            },
                            y: {
                                ticks: {
                                    color: getComputedStyle(document.body).color 
                                },
                                grid: {
                                    color: htmlElement.classList.contains('dark') ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                                }
                            }
                        }
                    }
                });
            }

            function getChartColors() {
                if (htmlElement.classList.contains('dark')) {
                    return {
                        maladie: { backgroundColor: 'rgba(252, 165, 165, 0.7)', borderColor: 'rgb(252, 165, 165)' }, 
                        atmp: { backgroundColor: 'rgba(253, 224, 71, 0.7)', borderColor: 'rgb(253, 224, 71)' }, 
                        maternityPaternity: { backgroundColor: 'rgba(221, 214, 254, 0.7)', borderColor: 'rgb(221, 214, 254)' } 
                    };
                } else {
                    return {
                        maladie: { backgroundColor: 'rgba(239, 68, 68, 0.7)', borderColor: 'rgb(239, 68, 68)' }, 
                        atmp: { backgroundColor: 'rgba(245, 158, 11, 0.7)', borderColor: 'rgb(245, 158, 11)' }, 
                        maternityPaternity: { backgroundColor: 'rgba(168, 85, 247, 0.7)', borderColor: 'rgb(168, 85, 247)' } 
                    };
                }
            }

            function updateChartColors() {
                const chartColors = getChartColors();
                comparisonChart.data.datasets[0].backgroundColor = chartColors.maladie.backgroundColor;
                comparisonChart.data.datasets[0].borderColor = chartColors.maladie.borderColor;
                comparisonChart.data.datasets[1].backgroundColor = chartColors.atmp.backgroundColor;
                comparisonChart.data.datasets[1].borderColor = chartColors.atmp.borderColor;
                comparisonChart.data.datasets[2].backgroundColor = chartColors.maternityPaternity.backgroundColor;
                comparisonChart.data.datasets[2].borderColor = chartColors.maternityPaternity.borderColor;
                
                // Update text and grid colors
                comparisonChart.options.plugins.title.color = getComputedStyle(document.body).color; 
                comparisonChart.options.scales.x.ticks.color = getComputedStyle(document.body).color; 
                comparisonChart.options.scales.y.ticks.color = getComputedStyle(document.body).color; 
                comparisonChart.options.scales.x.grid.color = htmlElement.classList.contains('dark') ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
                comparisonChart.options.scales.y.grid.color = htmlElement.classList.contains('dark') ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';

                comparisonChart.update();
            }

            initializeChart(); 
            
            const accordionToggles = document.querySelectorAll('.accordion-toggle');
            accordionToggles.forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const content = toggle.nextElementSibling;
                    const arrow = toggle.querySelector('span:last-child');
                    content.classList.toggle('hidden');
                    arrow.classList.toggle('rotate-180');
                });
            });

        });
    </script>
</body>
</html>
